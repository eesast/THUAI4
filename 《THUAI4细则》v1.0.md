# 《THUAI4》细则 v1.0

---

## 第一部分：给选手和C++组观看

### 游戏名称

+ **游戏名称**：待定

---

### 队伍组成

+ **队伍数量**：4

+ **队伍人数**：2

---

### 游戏简介

在游戏中，每个队员手中都有一杆枪，枪中装的子弹是五颜六色的墨水，每队的各个队员的墨水颜色都是一致的。这种墨水子弹在对落点处的非同色的队员造成一定伤害的同时，也会把周围的一片区域染成相应的颜色。如果一个队员被击中次数过多则会死亡（会受到相应的惩罚）。  

---

### 地图

+ **地图大小与形状**：50*50（暂定） 的矩形，每个小格是 1 x 1 的正方形  

+ **地图上的物件坐标是连续的**，坐标`(x, y)`可以映射为整数坐标`(x/1024, y/1024)`，看作该物件位于格子`(x/1024, y/1024)`内。例如，坐标为(40.3, 50.4)的人物处在map$[40][50]$中，通过访问map$[40][50]$可以获得所有坐标位于(40~41, 50~51)的游戏对象（人物、道具等）。同样，人物捡起道具以及染色等操作也是以格子为单位的，一次可以捡起自己所在的格子或自己面前的格子中的道具，染色也是一次染一个格子。

+ **地图上的物件**：墙（有碰撞），人物（有碰撞），子弹（视具体子弹而定），道具（无碰撞）

---

### 人物

+ **移动方式**：  

  + 可以向任意方向移动，移动采用极坐标： `Move(time, rad)` 以正右方向为极轴正方向，逆时针为正方向，向`rad`弧度方向移动`time`时间（毫秒）  
  + 简易移动方式：`MoveUp(time)`、`MoveDown(time)`、`MoveLeft(time)`、`MoveRight(time)`可以向上下左右四个方向移动`time`时间（毫秒）  

+ **视野**：人物可以通过函数`GetMapObj(x, y)`搜寻地图上以`(x, y)`为坐标的格子上的所有可见物品（此处x和y为除以1024以后的值，即一大格），人物是否有视野范围可以由C++组自行选择。

+ **属性**：生命值、职业、移动速度、目前拥有的道具（限持一个，之前道具会消失）、目前拥有的子弹数、装弹CD、最大子弹数、子弹类型、消息栏、面向方向（弧度）

+ **职业**：（由选手在编写代码时设定，职业对于任何角色是**不可见**的）

  + 职业0：无职业，向某一方向发射，遇到障碍或到达地图边界时爆炸，各种属性均一般。  

  1. 职业1：投掷型武器，子弹飞行的过程中不受任何干扰，直接命中目标点，伤害与染色范围（3*3）一般，子弹飞行速度快，装弹CD一般，生命值一般，人物移动速度一般。  
  2. 职业2：导弹型武器，可以向某一方向发射，遇到障碍或到达地图边界或达到射程上限时爆炸，伤害大，染色范围大，子弹飞行速度慢，装弹CD长，生命值较高，人物移动速度较慢。
  3. 职业3：拖泥带水型武器，子弹沿某一方向发射，会把子弹经过的路线全部染色，遇到障碍时或到达地图边界时爆炸，造成的伤害较小，爆炸处染色范围大，子弹飞行速度慢，装弹CD长，生命值较高，人物移动速度较快。  
  4. 职业4：攻击型武器，子弹飞行不受任何干扰，直接命中目标点，子弹飞行速度极快，对敌人伤害极大，但染色范围极小（只有命中的一格），装弹CD长，生命值较低，人物移动速度极快。  
  5. 职业5：人物拖泥带水：走路时会沿途把自己脚下的地图块染色，子弹像某一方向发射，遇到障碍或到达地图边界时爆炸，爆炸处伤害极小，子弹不能染色，生命值很低，装弹CD长，移动速度快。  
  6. 职业6：近战型武器。子弹使用后立即爆炸，爆炸时会把人物前面的一定范围内的全部染色，伤害极高，装弹CD长，生命值较低，人物移动速度快。
  7. 职业7：反弹伤害。与无职业子弹类型相同，子弹速度一般，生命值较高，移动速度慢。（子弹有显示主人的属性）

+ **人物在涂有与自己同一个颜色的格子上会缓慢增加生命值。**  

+ **主动行为**：  

  + 移动：参见“移动方式”
  + 攻击：`Attack(distance, rad)`使用极坐标，`distance`和`rad`分别是极径和极角，正右方向是极轴正方向，这两个参数不一定对各个职业都有作用
  + 捡道具：`Pick(Boolean isSame)`可以捡起与自己在同一格或者在自己前方那一格的道具，`isSame`标明是否是自己这一格（一个人物最多只能持有一个道具。如果手中已经有道具再去捡新道具，则原有的道具会被丢弃到新道具原先所在的位置）
  + 使用道具：`Use(para)`使用手中的道具（如果有的话），`para`是道具的附加参数。
  + 丢弃道具：`Throw(distance, rad)`，使用极坐标，把道具扔到该点处
  + 装弹：`AddBullet(num)`装`num`个子弹，装弹后总数目不超过人物的最大子弹数，使用此函数后人物会阻塞（无法强制其他动作）一段时间，时间与`num`和人物的装弹CD成正比

---

### 道具

+ **简介**：道具会在地图的任意一个没有碰撞障碍、没有草丛的地方随机生成，（如果有的话）一个道具的生成会覆盖掉该格子原先已经有的道具，即每个格最多只能容纳一个道具  

+ **具体道具**：
  + buff类道具
    1. 增加一段时间的移动速度
    2. 增加一段时间的子弹对敌人的伤害（以子弹从手中发射的时间计）
    3. 一段时间内装弹CD减短
    4. 回复大量的生命值
    5. 盾：使用后自己在一段时间内免受伤害，且打到自己的子弹不会有任何染色效果。
    6. 复活甲：使用后一段时间内消失，如果在消失之前如果被击中死亡，则原地满血满子弹复活，就像没死过一样。  
  + debuff类道具
    1. debuff地雷：在自己的脚下放地雷，一段时间后消失。地雷被埋下后就是不可见的，如果在消失前有人踩到了这一格，则会受到debuff，地雷造成伤害后立即消失，且地雷不会伤害到队友。地雷的debuff就是把上面buff中1~4的效果反过来，所以**这一条实际上对应了四种道具！**
    2. 眩晕地雷：同debuff地雷，但踩到后不是debuff，而是一段时间内不能行动，阻塞在原地。
  + 其它类道具
    1. 破盾：使用后一段时间内发射出的子弹无视盾的效果（时间以发射子弹的时刻计）

---

### 队友通信

`SendMessage(string)`可以向队友发一条字符串，发送后消息立即保存在队友的消息栏中，且会覆盖掉之前消息栏存在的消息。队友可以通过`string GetMMessage()`进行查看。每个人的消息栏存有的初始消息为`"THUAI4"`  

---

### 死亡处理

角色死亡后将会回到自己的出生点，并且失去所有的buff和debuff效果。

---

### 结算

得分结算方式：一个地图上的染着本队颜色的格子的数目成正比的量

---

## 第二部分：给通信组和C++组观看

### 通信格式

1. server to client

   1. 通信组：传递游戏对象的类，需要提供对应的函数接口给Server和Client（参考去年代码）

   ```C#
   //传递一个游戏对象，通信组和C++需要实现此类并提供一个方法，
   //可以向Client发送一个储存游戏对象的链表或数组以及Client的接收方法
   class GameObjMessage
   {
       enum ObjType
       {
           player = 0,
           wall = 1,
           prop = 2,
           bullet = 3
       }
       enum PropType
       {
           null = 0,
           /*其他的道具参见前面的说明，大概有12种道具*/
       }
       enum Job
       {
           null = 0,
           /*其他的人物职业参见第一部分*/
       }
       enum ObjType objType; 
       enum PropType propType; //如果是人物，那么本参数是持有的道具；
                                //如果是道具，那么本参数是道具类型
       int x; 		//精细坐标
       int y; 
       int moveSpeed; //移动速度
       int bulletNum; //当前持有的子弹数
       enum Job job; //职业
       int team; 	//人物所属队伍编号
       bool haveShield; //是否有盾
       bool haveFuhuojia; 
       bool speedUp; 	//是否有速度加成
       bool speedDown  //速度减慢
       bool attackUp; 	//是否有攻击力加成
       bool attackDown; //是否攻击力减慢
       bool isShocked; //是否处于眩晕状态
       double direction; //面对的方向
   }

   ```

   2. 地图更改信息，通信组和C++需实现此类，通信组需提供相应的方法，用于传递那些地图的哪一格更改成了什么颜色（并提供对应的函数接口给Server和Client）

      ```C#
      class MapColorChange
      {
          int x;
          int y;
          int team;     //变成了哪支队伍的颜色
      }
      ```

2. Client to Server
    客户端给Server的信息类，通信组和C++需要实现此类，通信组需实现相应的方法，用于传递本消息。
   ```C#
   class C2SMsg
   {
       enum MessageType
       {
           ChooseJob = 0,
           attack = 1,
           move = 2,
           use = 3,
           pick = 4
       }
       int para1;
       int para2;
       double para3;
       double para4;
       /*
       -- 对于ChooseJob消息，para1表示人物的ID，para2表示人物的职业，
            职业的值参见上面的Job枚举值
       -- 对于attack消息，para1代表角色ID
       para3代表距离
       para4代表角度
       -- 对于move消息，para3代表时间，其余同上
       -- 对于use消息，同attack
       -- 对于pick消息，para1代表角色ID，para2代表是否是本格的：
            true代表本格，false代表前面一个格
       */
   }
   ```
